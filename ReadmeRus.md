# UltraHLE

UltraHLE - классический эмулятор Nintendo 64. Шедевр.

![mario](mario.png)

Исходники взяты отсюда: https://code.google.com/archive/p/ultrahle/downloads

Приведены в порядок для сборки под Visual Studio 2022.

## Структура директорий

- src: оригинальные слегка модифцированные исходники
- Build: сюда будет собираться исполняемый файл
- Scripts: проект для VS2022, который ссылками тянет исходники и всё остальное из оригинальной папки src
- XGLIDE_Decompile: декомпиляция библиотеки XGLIDE. А почему бы и нет?

## Как модифицированы исходники

- Добавлен макрос `_CRT_SECURE_NO_WARNINGS` для unsafe вызовов
- Для сборки Release необходимо определить макрос `RELEASE=1`, иначе код консоли будет падать сразу после запуска эмулятора
- `stricmp` заменена на `_stricmp`
- `memicmp` заменена на `_memicmp`
- `strlwr` заменена на `_strlwr`
- Unicode: Not Set (UltraHLE не использует Unicode)
- Незначительные исправления в UltraHLE.rc и RESOURCE.H
- Базовый адрес исполняемого файла должен быть равен 0 (Linker->Advanced); Если вы не уверены в работе рекомпилятора, можно заменить вызов `go` на `sgo` в MAIN.C (`breakcommand("sgo");`)

## Сборка

Особенно ничего делать не требуется. Собирать можно в конфигурации Debug/Release x86.

x64 сборка не поддерживается, т.к. UltraHLE использует inline ассемблер в .C файлах, который нельзя использовать в x64.

:warning: Работа эмулятора в Release очень нестабильная, причём падает в самом начале, сразу после запуска. Где-то проблема в неполностью отключенном отладочном UI.

## Glide

UltraHLE требуется устаревший графический API Glide 2.0.

Враппер можно взять тут: http://www.zeckensack.de/glide/

Иногда после запуска враппера в Windows нарушается яркость экрана. Для сброса достаточно нажать Win+I и перейти на вкладку Display.
